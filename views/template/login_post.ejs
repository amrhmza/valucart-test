<script type="text/javascript" src="js/jquery.cookie.min.js"></script>
<script type="text/javascript">
    $(function () {
        //console.log($.cookie("vcartAuth"));
        //console.log($.cookie());

        $('#login-form').submit(function (e) {
            e.preventDefault();
            var username = $(".login_username").val();
            var password = $(".login_password").val();

            if (username == "") $(".login_username").parent(".form-group").addClass("has-error");
            else $(".login_username").parent(".form-group").removeClass("has-error");

            if (password == "") $(".login_password").parent(".form-group").addClass("has-error");
            else $(".login_password").parent(".form-group").removeClass("has-error");

            if (username != "" && password != "") {
                var data = { username, password };

                $.ajax({
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    url: 'https://staging.valucart.com:3000/auth/login'
                }).done(function (resp) {
                    if (resp.status == "success") {
                        resp.useremail = username;
                        console.log(JSON.stringify(resp));

                        $.cookie('vcartAuth', JSON.stringify(resp), { expires: 7, path: '/' });
                        if (!resp.is_email_verified) {
                            var base_url = window.location.origin;
                            window.location.replace(base_url + "/otp");
                        }
                        else
                            location.reload(true);
                    }
                    else {
                        $(".login-action-msg").html(resp.status).addClass("has-error");
                        console.log("Invalid Username/Password");
                    }
                }).fail(function (r) {
                    console.log(JSON.stringify(r));
                    $(".login-action-msg").html(r.responseJSON.error).addClass("has-error");
                });
            }
        });

        $(".vcartLogout").on("click", function () {
            $.removeCookie('vcartAuth', { path: '/' });

            /* var cookies = $.cookie();
            for(var cookie in cookies) {
                $.removeCookie(cookie);
            } */

            location.reload(true);
        });

        /* var vCook= $.cookie("vcartAuth");
        if(vCook){
            var emailVerify = JSON.parse(vCook).is_email_verified;
            if(!emailVerify)
                window.location.href="/otp";
        } */
    });
    function onLoadGoogleCallback() {
        gapi.load('auth2', function () {
            auth2 = gapi.auth2.init({
                client_id: '937569373900-g6jtmi0c9e4jjvh9shnclpfehiqkcpn2.apps.googleusercontent.com',
                cookiepolicy: 'single_host_origin',
                scope: 'profile email'
            });

            auth2.attachClickHandler(element1, {},
                function (googleUser) {
                    let gdata = googleUser.getBasicProfile();
                    let gtoken = googleUser.getAuthResponse().id_token;

                    let data = {};
                    data["user_id"] = gdata.Eea;
                    data["token"] = gtoken;
                    data["sso_type"] = 1;
                    $.ajax({
                        type: "POST",
                        data: JSON.stringify(data),
                        contentType: "application/json",
                        url: "https://staging.valucart.com:3000/auth/ssoLogin"
                    })
                        .done(function (resp) {
                            if (resp.status == "success") {
                                resp.useremail = resp.email;
                                console.log(JSON.stringify(resp));

                                $.cookie("vcartAuth", JSON.stringify(resp), {
                                    expires: 7,
                                    path: "/"
                                });
                                if (!resp.is_email_verified) {
                                    var base_url = window.location.origin;
                                    window.location.replace(base_url + "/otp");
                                } else location.reload(true);
                            } else {
                                console.log("Invalid Account");
                                toastr.error("Invalid Account");
                            }
                        })
                        .fail(function (r) {
                            console.log(JSON.stringify(r));
                            toastr.error("Invalid Account");
                        });
                });
            auth2.attachClickHandler(element, {},
                function (googleUser) {
                    let gdata = googleUser.getBasicProfile();
                    let gtoken = googleUser.getAuthResponse().id_token;
                    $.ajax({
                        type: "POST",
                        data: JSON.stringify({
                            username: gdata.ig,
                            user_id: gdata.Eea,
                            user_phone_no: "",
                            user_email: gdata.U3,
                            user_first_name: gdata.ofa,
                            user_last_name: gdata.wea,
                            user_city: "",
                            user_area: "",
                            token: gtoken,
                            sso_type: 1
                        }),
                        contentType: "application/json",
                        url: "https://staging.valucart.com:3000/auth/ssoRegister",
                        success: function (resp) {
                            if (resp.status == "success") {
                                resp.useremail = resp.email;
                                console.log(JSON.stringify(resp));

                                $.cookie("vcartAuth", JSON.stringify(resp), {
                                    expires: 7,
                                    path: "/"
                                });
                                if (!resp.is_email_verified) {
                                    var base_url = window.location.origin;
                                    window.location.replace(base_url + "/otp");
                                } else location.reload(true);
                            } else {
                                console.log("Invalid Account");
                                toastr.error("Invalid Account");
                            }
                        },
                        error: function (error) {
                            toastr.error(error.responseJSON.error);
                        }
                    })
                });
        });
        element = document.getElementById('googleSignIn');
        element1 = document.getElementById('googleSignup');
    }
</script>