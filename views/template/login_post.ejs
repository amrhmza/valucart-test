<script type="text/javascript" src="js/jquery.cookie.min.js"></script>
<script type="text/javascript">
    $(function() {
        //console.log($.cookie("vcartAuth"));
        //console.log($.cookie());

        $('#login-form').submit(function(e) {
            e.preventDefault();
            var username = $(".login_username").val();
            var password = $(".login_password").val();

            if(username=="") $(".login_username").parent(".form-group").addClass("has-error");
            else $(".login_username").parent(".form-group").removeClass("has-error");

            if(password=="") $(".login_password").parent(".form-group").addClass("has-error");
            else $(".login_password").parent(".form-group").removeClass("has-error");

            if(username !="" && password!=""){
                var data = {username, password};

                $.ajax({
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    url: 'http://18.191.0.240:3000/auth/login'
                }).done(function(resp){
                    if(resp.status=="success"){
                        resp.useremail= username;
                        console.log(JSON.stringify(resp));

                        $.cookie('vcartAuth', JSON.stringify(resp), { expires: 7, path: '/' });
                        if(!resp.is_email_verified){
                            var base_url = window.location.origin;
                            window.location.replace(base_url+"/otp");
                        }
                        else
                            location. reload(true);
                    }
                    else{
                        $(".login-action-msg").html(resp.status).addClass("has-error");
                        console.log("Invalid Username/Password");
                    }
                }).fail(function(r){
                    console.log(JSON.stringify(r));
                    $(".login-action-msg").html(r.responseJSON.error).addClass("has-error");
                });
            }
        });

        $(".vcartLogout").on("click",function(){
            $.removeCookie('vcartAuth', { path: '/' });
            
            /* var cookies = $.cookie();
            for(var cookie in cookies) {
                $.removeCookie(cookie);
            } */

            location. reload(true);
        });
        
        /* var vCook= $.cookie("vcartAuth");
        if(vCook){
            var emailVerify = JSON.parse(vCook).is_email_verified;
            if(!emailVerify)
                window.location.href="/otp";
        } */
    });
</script>